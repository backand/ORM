<head>
  <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
  <!-- jQuery is used only for this example; it isn't required to use Stripe -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <!-- New section -->
  <script type="text/javascript">
    <!-- Fill in your publishable key -->
    Stripe.setPublishableKey('pk_test_jJi11byQmWBgCmu07v8b8XCe');

   var stripeResponseHandler = function(status, response) {
     var $form = $('#payment-form');

     if (response.error) {
       // Show the errors on the form
       $form.find('.payment-errors').text(response.error.message);
       $form.find('button').prop('disabled', false);
     } else {
       // token contains id, last4, and card type
       var token = response.id;
       console.log(token);
       // Insert the token into the form so it gets submitted to the server
       // $form.append($('<input type="hidden" name="stripeToken" />').val(token));
       // and re-submit
       // $form.get(0).submit();

       $.ajax({

        method: "POST",
        url: "http://localhost:9000/charge",

        dataType: 'json',

        data: {
          token: token,
          amount: $('#amount').val(),
          currency: $('#currency').val(),
          description: $('#description').val()
        },

        success: function(data, textStatus, jqXHR ){
          console.log("success");
          console.log(textStatus);
          console.log(data);
        },

        error: function(jqXHR, textStatus, errorThrown ){
          console.log("error");
          console.log(textStatus);
          console.log(errorThrown);
        }

       });

     }
   };

   jQuery(function($) {
     $('#payment-form').submit(function(e) {
       var $form = $(this);

       // Disable the submit button to prevent repeated clicks
       $form.find('button').prop('disabled', true);

       Stripe.card.createToken($form, stripeResponseHandler);

       // Prevent the form from submitting with the default action
       return false;
     });
   });
 </script>
</head>
<body>
<!-- Now change all the name attributes on your credit card inputs to data-stripe instead -->
  <form action="charge" method="POST" id="payment-form">
      <!-- Add a section to display errors if you want -->
      <span class='payment-errors'></span>
      <input data-stripe="number" placeholder="credit card"/>
      <input data-stripe="cvc" placeholder="cvc"/>
      <input data-stripe="exp-month" placeholder="month"/>
      <input data-stripe="exp-year" placeholder="year"/>
      <input id="description" placeholder="description"/>
      <input id="amount" placeholder="amount"/>
      <input id="currency" placeholder="currency code"/>
      <button type="submit">Submit Payment</button>
  </form>
</body>